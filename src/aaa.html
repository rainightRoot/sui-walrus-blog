<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Walrus å›¾ç‰‡ä¸Šä¼ ä¸å›æ˜¾ Demo</title>
</head>
<body>
  <h2>ğŸ“¤ ä¸Šä¼ å›¾ç‰‡å¹¶åœ¨ä¸‹æ–¹é¢„è§ˆï¼š</h2>

  <input type="file" id="fileInput" accept="image/*" />
  <button onclick="upload()">ä¸Šä¼ </button>

  <p id="status"></p>

  <h3>ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆï¼š</h3>
  <img id="preview" style="max-width: 400px; border: 1px solid #ccc;" />

  <script>
    const PUBLISHER = 'https://walrus-publisher-testnet.equinoxdao.xyz';
    const AGGREGATOR = 'https://aggregator.walrus-testnet.walrus.space';

    const RECEIVER_ADDRESS = '0x6c9b67c2290f3a9b3d7d1abdc9d1eaaa6df7c9fd3ff45675cf22893a1f294ce9'; // ä½ çš„é’±åŒ…åœ°å€
    const EPOCHS = 5;

    async function upload() {
      const fileInput = document.getElementById('fileInput');
      const status = document.getElementById('status');
      const preview = document.getElementById('preview');

      if (!fileInput.files.length) {
        alert('è¯·é€‰æ‹©å›¾ç‰‡');
        return;
      }

      const file = fileInput.files[0];
      status.innerText = 'ä¸Šä¼ ä¸­...';

      const url = `${PUBLISHER}/v1/blobs?epochs=${EPOCHS}&send_object_to=${RECEIVER_ADDRESS}`;

      try {
        const res = await fetch(url, {
          method: 'PUT',
          headers: {
            'Content-Type': file.type || 'application/octet-stream',
          },
          body: file
        });

        if (!res.ok) {
          throw new Error(await res.text());
        }

        const ress = (await res.json());
        console.log('ä¸Šä¼ æˆåŠŸï¼Œres:', ress);
        const blobId = ress.alreadyCertified.blobId;
        console.log('ä¸Šä¼ æˆåŠŸï¼ŒblobId:', blobId);

        status.innerText = `ä¸Šä¼ æˆåŠŸï¼blobId: ${blobId}`;

        // æ˜¾ç¤ºå›¾ç‰‡
        preview.src = `${AGGREGATOR}/v1/blobs/${blobId}`;
      } catch (err) {
        console.error(err);
        status.innerText = 'ä¸Šä¼ å¤±è´¥ï¼š' + err.message;
      }
    }
  </script>
</body>
</html>